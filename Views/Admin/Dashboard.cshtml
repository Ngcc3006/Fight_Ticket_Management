@model List<CNPMNC.Controllers.UserWithRoleViewModel>
    @{
    ViewData["Title"] = "Admin Dashboard";
    Layout = "_Layout";
    }

    <!DOCTYPE html>
    <html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    </head>
    <body>
        <div class="container mt-4">
            <div class="alert alert-primary">
                <h1><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h1>
                <p>Quản lý người dùng và hệ thống</p>
            </div>

            @if (TempData["Success"] != null)
        {
            <div class="alert alert-success">@TempData["Success"]</div>
        }

            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5>Tổng người dùng</h5>
                            <h2>@Model.Count</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5>Admins</h5>
                            <h2>@Model.Count(u => u.Roles.Contains("Admin"))</h2>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5>Users</h5>
                            <h2>@Model.Count(u => u.Roles.Contains("User"))</h2>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h4>Danh sách người dùng</h4>
                </div>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Roles</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in Model)
                        {
                            <tr>
                                <td>@user.UserName</td>
                                <td>@user.Email</td>
                                <td>
                                    @if (user.Roles.Contains("Admin"))
                                    {
                                    <span class="badge bg-danger">Admin</span>
                                    }
                                    else
                                    {
                                    <span class="badge bg-success">User</span>
                                    }
                                </td>
                                <td>
                                    <form method="post" asp-action="ChangeRole" style="display:inline;">
                                        <input type="hidden" name="userId" value="@user.Id" />
                                        <select name="role" class="form-select form-select-sm" style="width:120px; display:inline;" onchange="this.form.submit()">
                                            <option value="User" selected="@(user.Roles.Contains("User"))">User</option>
                                            <option value="Admin" selected="@(user.Roles.Contains("Admin"))">Admin</option>
                                        </select>
                                    </form>

                                    <form method="post" asp-action="DeleteUser" style="display:inline;"
                                          onsubmit="return confirm('Xóa user này?');">
                                        <input type="hidden" name="id" value="@user.Id" />
                                        <button type="submit" class="btn btn-danger btn-sm">Xóa</button>
                                    </form>
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="text-center mt-3">
                <form method="post" asp-controller="Account" asp-action="Logout">
                    <button type="submit" class="btn btn-secondary">Đăng xuất</button>
                </form>
            </div>
        </div>
    </body>
</html>
